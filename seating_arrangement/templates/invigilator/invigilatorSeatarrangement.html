<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Student Seats</title>
    <link href="{% static 'sidebar.css' %}" rel="stylesheet" />
    <link href="{% static 'common.css' %}" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        .glass-bg { background: rgba(255,255,255,0.88); backdrop-filter: blur(8px); border-radius: 18px; box-shadow: 0 6px 24px rgba(60,72,88,0.1); padding: 30px; margin-bottom: 2rem; }
        .seat-input { width: 80px; text-align: center; }
        .room-select { min-width: 120px; }
    </style>
</head>
<body class="bg-light">
<div class="container-fluid min-vh-100 d-flex flex-column">
    <div class="row flex-grow-1">

        <!-- Sidebar -->
        <div id="sidebarWrapper" class="col-lg-2 d-none d-lg-block p-0 bg-dark">
            {% include 'components/invigilatorsidebar.html' with statusRD="active" %}
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="col p-0">
            {% include 'components/Header.html' with title="Edit Student Seats" %}

            <div class="container-fluid py-4">

                <!-- 🔍 Search + Filters -->
                <div class="glass-bg mb-4">
                    <form method="get" class="row g-3 align-items-end">
                        <div class="col-md-2">
                            <label class="form-label">Search</label>
                            <input type="text" name="search" value="{{ search_query }}" placeholder="Roll no. or Name" class="form-control" />
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Course</label>
                            <select name="course" class="form-select">
                                <option value="">All</option>
                                {% for course in courses %}
                                    <option value="{{ course.id }}" {% if course_filter == course.id|stringformat:"s" %}selected{% endif %}>
                                        {{ course.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Department</label>
                            <select name="department" class="form-select">
                                <option value="">All</option>
                                {% for dept in departments %}
                                    <option value="{{ dept.id }}" {% if dept_filter == dept.id|stringformat:"s" %}selected{% endif %}>
                                        {{ dept.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-1">
                            <label class="form-label">Year</label>
                            <select name="year" class="form-select">
                                <option value="">All</option>
                                {% for y in years %}
                                    <option value="{{ y }}" {% if year_filter == y|stringformat:"s" %}selected{% endif %}>
                                        {{ y }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Debarred</label>
                            <select name="debarred" class="form-select">
                                <option value="">All</option>
                                <option value="yes" {% if debarred_filter == "yes" %}selected{% endif %}>Only Debarred</option>
                                <option value="no" {% if debarred_filter == "no" %}selected{% endif %}>Only Not Debarred</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">Filter</button>
                        </div>
                        <div class="col-md-1">
                            <a href="{% url 'invigilatorseatarrangement' %}" class="btn btn-secondary w-100">Reset</a>
                        </div>
                        

                    </form>
                </div>
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
                <!-- 📋 Table with seats + rooms -->
                <div class="glass-bg">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <table class="table table-striped align-middle">
                            <thead>
                                <tr>
                                    <th>Roll No</th>
                                    <th>Name</th>
                                    <th>Course</th>
                                    <th>Dept</th>
                                    <th>Year</th>
                                    <th>Class</th>
                                    <th>Seat</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for student in students %}
                                {% with seating=student.seating_set.first %}
                                <tr class="{% if student.is_debarred %}table-danger{% endif %}">
                                    <td>{{ student.roll_number }}</td>
                                    <td>{{ student.name }}</td>
                                    <td>{{ student.course.name }}</td>
                                    <td>{{ student.department.name }}</td>
                                    <td>{{ student.get_year_display }}</td>
                                    <td>
                                        <select name="room_{{ student.roll_number }}" class="form-select room-select" {% if student.is_debarred %}disabled{% endif %}>
                                            <option value="">-- Select Room --</option>
                                            {% for room in rooms %}
                                                <option value="{{ room.room_number }}" {% if seating and seating.room and seating.room.id == room.id %}selected{% endif %}>
                                                    {{ room.room_number }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td>
                                        <input type="text" name="seat_{{ student.roll_number }}" value="{% if seating %}{{ seating.seat_number }}{% endif %}" class="form-control seat-input" {% if student.is_debarred %}disabled{% endif %} />
                                    </td>
                                    <td>
                                        <button type="submit" name="debar_{{ student.roll_number }}" class="btn btn-danger btn-sm" {% if student.is_debarred %}disabled{% endif %}>Debar</button>
                                    </td>
                                </tr>
                                {% endwith %}
                                {% endfor %}
                            </tbody>
                        </table>

                        

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
